<div class="container">
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="header-tabs">
        <div class="tab" [class.active]="activeTab === 'stations'" (click)="switchTab('stations')">
          Электростанции
        </div>
        <div class="tab" [class.active]="activeTab === 'units'" (click)="switchTab('units')">
          Электроагрегаты
        </div>
      </div>
    </div>
    
    <!-- Контент станций -->
    <div class="tab-content" *ngIf="activeTab === 'stations'">
      <div class="components-tree">
        <ul class="tree">
          <li *ngFor="let station of stations" class="tree-item">
            <div class="tree-node"  
                 [class.selected]="selectedStation?.id === station.id"
                 (click)="selectStation(station)">
              <span class="component-name" [title]="station.name">{{station.name}}</span>
            </div>
          </li>
          <button type="button" class="add-button" (click)="openAddStationForm()" *ngIf="userRole==='admin'">
            + Добавить ЭСН
          </button>
        </ul>
      </div>
    </div>

    <!-- Контент электроагрегатов -->
    <div class="tab-content" *ngIf="activeTab === 'units'">
      <div class="components-tree">
        <ul class="tree">
          <li *ngFor="let unit of units" class="tree-item">
            <div class="tree-node"
                 [class.selected]="selectedUnit?.id === unit.id"
                 (click)="selectUnit(unit)">
              <span class="component-name" [title]="unit.unitType">{{unit.unitType}}</span>
            </div>
          </li>
          <button type="button" class="add-button" (click)="openAddUnitForm()" *ngIf="userRole==='admin'">
            + Добавить агрегат
          </button>
        </ul>
      </div>
    </div>
  </div>

  <!-- Основное содержимое (будет посередине) -->
  <div class="main-content" [class.collapsed]="isPanelCollapsed">
  </div>

  <!-- Сворачиваемая правая панель -->
  <div class="content-panel" *ngIf="selectedStation || selectedUnit" [class.collapsed]="isPanelCollapsed">
    <!-- Кнопка сворачивания -->
    <div class="panel-toggle" (click)="togglePanel()">
      <span class="toggle-icon" [class.collapsed]="isPanelCollapsed">i</span>
    </div>

    <!-- Содержимое панели -->
    <div class="panel-content" *ngIf="!isPanelCollapsed">
      <!-- Информация для электростанций -->
      <div *ngIf="activeTab === 'stations' && selectedStation" class="details-container">
        <div class="details-header">
          <h2>{{selectedStation.name}}</h2>
        </div>
        
        <div class="info-section">
          <h3>Основные характеристики</h3>
          <div class="properties-list compact">
            <div class="property-item">
              <span class="property-label">Количество агрегатов:</span>
              <span class="property-value">{{selectedStation.activeUnitsCount}}</span>
            </div>
            <div class="property-item">
              <span class="property-label">Тип агрегатов:</span>
              <span class="property-value">{{selectedStation.unitType}}</span>
            </div>
            <div class="property-item">
              <span class="property-label">Дата запуска:</span>
              <span class="property-value">{{selectedStation.launchDate | date:'dd.MM.yyyy'}}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Информация для электроагрегатов -->
      <div *ngIf="activeTab === 'units' && selectedUnit" class="details-container">
        <div class="details-header">
          <h2>{{selectedUnit.unitType}}</h2>
        </div>
        
        <div class="info-section">
          <h3>Технические характеристики</h3>
          <div class="properties-list compact">
            <div class="property-item">
              <span class="property-label">Тип двигателя:</span>
              <span class="property-value">{{selectedUnit.engineType}}</span>
            </div>
            <div class="property-item">
              <span class="property-label">Ном. мощность:</span>
              <span class="property-value">{{selectedUnit.ratedPower}} МВт</span>
            </div>
            <div class="property-item">
              <span class="property-label">Станд. мощность:</span>
              <span class="property-value">{{selectedUnit.standartPower}} МВт</span>
            </div>
            <div class="property-item">
              <span class="property-label">Расход газа:</span>
              <span class="property-value">{{selectedUnit.consumptionNorm}} м³/ч</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно для добавления станции -->
<div class="modal-overlay" *ngIf="showAddStationForm" (click)="closeAddStationForm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Добавление новой электростанции</h3>
      <button class="close-button" (click)="closeAddStationForm()">&times;</button>
    </div>
    
    <form class="add-station-form" #stationForm="ngForm">
      <div class="form-group">
        <label for="stationName">Название станции *</label>
        <input type="text" id="stationName" 
               [(ngModel)]="newStation.name" 
               name="stationName"
               required
               placeholder="Введите название станции">
      </div>

      <div class="form-group">
        <label for="unitType">Тип агрегатов *</label>
        <select id="unitType" 
                [(ngModel)]="newStation.unitType" 
                name="unitType"
                required>
          <option value="">Выберите тип агрегатов</option>
          <option *ngFor="let unit of units" [value]="unit.unitType">
            {{unit.unitType}}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="activeUnitsCount">Количество агрегатов *</label>
        <input type="number" id="activeUnitsCount" 
               [(ngModel)]="newStation.activeUnitsCount" 
               name="activeUnitsCount"
               required
               min="1"
               max="20"
               placeholder="Введите количество">
      </div>

      <div class="form-group">
        <label for="launchDate">Дата запуска *</label>
        <input type="date" id="launchDate" 
               [(ngModel)]="newStation.launchDate" 
               name="launchDate"
               required>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="closeAddStationForm()">Отмена</button>
        <button type="button" class="btn-submit" 
                [disabled]="!stationForm.form.valid"
                (click)="addStation()">
          Добавить станцию
        </button>
        <div *ngIf="stMsg" class="message" [class.error]="stMsg !== 'Success'">
        {{stMsg}}
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Модальное окно для добавления агрегата -->
<div class="modal-overlay" *ngIf="showAddUnitForm" (click)="closeAddUnitForm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Добавление нового электроагрегата</h3>
      <button class="close-button" (click)="closeAddUnitForm()">&times;</button>
    </div>
    
    <form class="add-station-form" #unitForm="ngForm">
      <div class="form-group">
        <label for="unitType">Тип агрегата *</label>
        <input type="text" id="unitType" 
               [(ngModel)]="newUnit.unitType" 
               name="unitType"
               required
               placeholder="Введите тип агрегата">
      </div>

      <div class="form-group">
        <label for="engineType">Тип двигателя *</label>
        <select id="engineType" 
                [(ngModel)]="newUnit.engineType" 
                name="engineType"
                required>
          <option value="">Выберите тип двигателя</option>
          <option value="Газотурбинный">Газотурбинный</option>
          <option value="Поршневой">Поршневой</option>
        </select>
      </div>

      <div class="form-group">
        <label for="ratedPower">Номинальная мощность (МВт) *</label>
        <input type="number" id="ratedPower" 
               [(ngModel)]="newUnit.ratedPower" 
               name="ratedPower"
               required
               min="0.1"
               max="100"
               step="0.1"
               placeholder="Введите номинальную мощность">
      </div>

      <div class="form-group">
        <label for="standartPower">Стандартная мощность (МВт) *</label>
        <input type="number" id="standartPower" 
               [(ngModel)]="newUnit.standartPower" 
               name="standartPower"
               required
               min="0.1"
               max="100"
               step="0.1"
               placeholder="Введите стандартную мощность">
      </div>

      <div class="form-group">
        <label for="consumptionNorm">Норма расхода газа (м³/ч) *</label>
        <input type="number" id="consumptionNorm" 
               [(ngModel)]="newUnit.consumptionNorm" 
               name="consumptionNorm"
               required
               min="1"
               max="10000"
               step="1"
               placeholder="Введите норму расхода газа">
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="closeAddUnitForm()">Отмена</button>
        <button type="button" class="btn-submit" 
                [disabled]="!unitForm.form.valid"
                (click)="addUnit()">
          Добавить агрегат
        </button>
        <div *ngIf="uMsg" class="message" [class.error]="uMsg !== 'Success'">
        {{uMsg}}
        </div>
      </div>
    </form>
  </div>
</div>
